---
import Base from "@/layouts/Base.astro";
import { getSinglePage } from "@/lib/contentParser.astro";
import { sortByDate } from "@/lib/utils/sortFunctions";
import dateFormat from "@/lib/utils/dateFormat";
import { humanize, slugify } from "@/lib/utils/textConverter";
import { Image } from "astro:assets";
import placeholder from "@/assets/images/placeholder.png";
import capaPrincipalMandamento from "@/assets/images/capa-principal-mandamento.jpg";
import capaGestaoPessoas from "@/assets/images/capa-gestao-pessoas.png";

const posts = await getSinglePage("posts");
const sortedPosts = sortByDate(posts).slice(0, 4);
---

<Base>
  <section class="relative bg-dark pt-24 pb-20 sm:pt-32 sm:pb-28 lg:pt-48 lg:pb-40 overflow-hidden -mt-[60px]">
      <div class="absolute inset-0 bg-gradient-to-br from-dark to-slate-800 opacity-90"></div>
      <div class="absolute top-0 right-0 -mt-20 -mr-20 w-64 h-64 sm:w-80 sm:h-80 bg-primary blur-[100px] sm:blur-[120px] opacity-20"></div>
      
      <div class="relative max-w-4xl mx-auto px-4 sm:px-6 text-center z-10 mt-[60px]">
          <h1 class="font-primary text-4xl sm:text-5xl md:text-7xl font-bold text-white leading-tight mb-6 sm:mb-8">
              Clareza para mentes exaustas. <br/> <span class="text-primary italic font-medium">Graça para líderes.</span>
          </h1>
          <p class="text-slate-300 text-base sm:text-lg md:text-xl font-secondary font-light mb-0 max-w-2xl mx-auto leading-relaxed px-2">
              A intersecção onde a precisão da gestão de alta performance encontra a profunda neuroplasticidade da fé.
          </p>
      </div>
  </section>

  <section id="ensaios" class="max-w-5xl mx-auto px-4 sm:px-6 py-20">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 border-b border-gray-200 pb-6">
          <div>
              <h2 class="font-primary text-3xl sm:text-4xl font-bold text-dark">Postagens Recentes</h2>
              <p class="text-text mt-2">Reflexões recentes enviadas aos domingos.</p>
          </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-10 lg:gap-12">
          {sortedPosts.map((post) => (
              <article class="group flex flex-col gap-5 items-start">
                  <a href={`/blog/${post.id}`} class="block w-full overflow-hidden rounded-none shadow-sm relative">
                      <div class="absolute inset-0 bg-primary opacity-0 group-hover:opacity-10 transition-opacity duration-500 z-10"></div>
                      <Image
                          src={post.data.image || placeholder}
                          alt={post.data.title}
                          width={800}
                          height={450}
                          widths={[400, 600, 800]}
                          sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 450px"
                          loading={sortedPosts.indexOf(post) === 0 ? "eager" : "lazy"}
                          fetchpriority={sortedPosts.indexOf(post) === 0 ? "high" : "auto"}
                          class="w-full aspect-[16/9] object-cover group-hover:scale-105 transition-transform duration-700"
                          format="webp"
                      />
                  </a>
                  <div class="flex-1 w-full">
                      <div class="flex items-center space-x-2 mb-2">
                          {post.data.tags && post.data.tags.length > 0 && (
                              <a href={`/tags/${slugify(post.data.tags[0])}`} class="text-dark text-[11px] font-bold uppercase tracking-wider hover:underline">
                                  {humanize(post.data.tags[0])}
                              </a>
                          )}
                          <span class="text-slate-300 text-xs">•</span>
                          <time class="text-slate-500 text-[11px] font-medium">{dateFormat(post.data.date)}</time>
                      </div>
                      <a href={`/blog/${post.id}`} class="block">
                          <h3 class="font-primary text-2xl sm:text-3xl font-bold text-dark group-hover:text-slate-600 transition-colors mb-2 leading-tight">
                              {post.data.title}
                          </h3>
                      </a>
                  </div>
              </article>
          ))}
      </div>
      
      <div class="mt-16 text-center">
          <a href="/arquivo" class="inline-block bg-white border border-gray-200 text-dark px-10 py-4 hover:bg-dark hover:text-white hover:border-dark font-bold text-sm tracking-widest uppercase transition-all duration-300 shadow-sm">
              Explorar o Arquivo Completo
          </a>
      </div>
  </section>

  <section id="livros" class="max-w-5xl mx-auto px-4 sm:px-6 pt-12 md:pt-16 pb-24 md:pb-32">
      <div class="flex flex-col mb-16 md:mb-20 text-center">
          <h2 class="font-primary text-3xl sm:text-4xl md:text-5xl font-bold text-dark tracking-tight">A Biblioteca</h2>
          <p class="text-slate-500 mt-4 max-w-2xl mx-auto font-light text-base md:text-lg">Manuais práticos para a sua mente e liderança. Pague o quanto quiser. O conhecimento não deve ter barreiras.</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-10">
          
          <div class="group flex flex-col sm:flex-row gap-6 md:gap-10 lg:gap-8 bg-white p-6 md:p-10 lg:p-8 shadow-[0_2px_10px_-4px_rgba(0,0,0,0.05)] border border-gray-100 hover:shadow-[0_20px_40px_-10px_rgba(0,0,0,0.08)] transition-all duration-500 items-center sm:items-start relative overflow-hidden">
              <div class="w-48 sm:w-44 md:w-56 lg:w-40 shrink-0 relative shadow-[0_15px_30px_-10px_rgba(0,0,0,0.3)] group-hover:-translate-y-2 group-hover:shadow-[0_20px_40px_-12px_rgba(0,0,0,0.4)] transition-all duration-500 ease-out z-10">
                <div class="absolute inset-0 bg-gradient-to-r from-black/20 via-transparent to-transparent z-10 pointer-events-none"></div>
                <div class="absolute left-0 top-0 bottom-0 w-[1px] bg-white/30 z-20 pointer-events-none"></div>
                <Image
                    src={capaPrincipalMandamento}
                    alt="O Principal Mandamento"
                    width={300}
                    height={450}
                    class="w-full h-auto object-contain block"
                />
              </div>
              <div class="flex flex-col justify-center text-center sm:text-left h-full z-10 w-full min-w-0">
                  <span class="text-[10px] md:text-xs font-bold uppercase tracking-[0.2em] text-slate-500 mb-2 lg:mb-3 block">Lançamento</span>
                  <h3 class="font-primary text-2xl md:text-3xl lg:text-2xl font-bold text-dark mb-3 lg:mb-4 leading-snug group-hover:text-slate-700 transition-colors duration-300 break-words">O Principal Mandamento</h3>
                  <p class="text-sm md:text-base lg:text-sm text-slate-500 font-light mb-6 lg:mb-8 line-clamp-3 leading-relaxed">O Evangelho que o mundo não quer ouvir. Uma desconstrução do nosso orgulho.</p>
                  <button class="bg-dark border border-dark text-white hover:bg-white hover:text-dark px-6 py-3 text-xs font-bold tracking-[0.15em] uppercase transition-all duration-300 self-center sm:self-start mt-auto">
                      Ler Agora
                  </button>
              </div>
          </div>

          <div class="group flex flex-col sm:flex-row gap-6 md:gap-10 lg:gap-8 bg-white p-6 md:p-10 lg:p-8 shadow-[0_2px_10px_-4px_rgba(0,0,0,0.05)] border border-gray-100 hover:shadow-[0_20px_40px_-10px_rgba(0,0,0,0.08)] transition-all duration-500 items-center sm:items-start relative overflow-hidden">
              <div class="w-48 sm:w-44 md:w-56 lg:w-40 shrink-0 relative shadow-[0_15px_30px_-10px_rgba(0,0,0,0.3)] group-hover:-translate-y-2 group-hover:shadow-[0_20px_40px_-12px_rgba(0,0,0,0.4)] transition-all duration-500 ease-out z-10">
                <div class="absolute inset-0 bg-gradient-to-r from-black/20 via-transparent to-transparent z-10 pointer-events-none"></div>
                <div class="absolute left-0 top-0 bottom-0 w-[1px] bg-white/30 z-20 pointer-events-none"></div>
                <Image
                    src={capaGestaoPessoas}
                    alt="Gestão de Pessoas"
                    width={300}
                    height={450}
                    class="w-full h-auto object-contain block"
                />
              </div>
              <div class="flex flex-col justify-center text-center sm:text-left h-full z-10 w-full min-w-0">
                  <span class="text-[10px] md:text-xs font-bold uppercase tracking-[0.2em] text-slate-500 mb-2 lg:mb-3 block">Business & Fé</span>
                  <h3 class="font-primary text-2xl md:text-3xl lg:text-2xl font-bold text-dark mb-3 lg:mb-4 leading-snug group-hover:text-slate-700 transition-colors duration-300 break-words">Gestão de Pessoas</h3>
                  <p class="text-sm md:text-base lg:text-sm text-slate-500 font-light mb-6 lg:mb-8 line-clamp-3 leading-relaxed">Para Alta Performance. Desvendando o Potencial Humano para Resultados Extraordinários.</p>
                  <button class="bg-dark border border-dark text-white hover:bg-white hover:text-dark px-6 py-3 text-xs font-bold tracking-[0.15em] uppercase transition-all duration-300 self-center sm:self-start mt-auto">
                      Ler Agora
                  </button>
              </div>
          </div>

      </div>
  </section>
</Base>
